<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UpdateLog</title>
<link rel="icon" type="image/png" href="https://i.imgur.com/77SkRfy.png">
<style>
:root {
  --bg: #000a00;
  --text: #7CFF7C;
  --muted: #4a8b4a;
  --glow: rgba(124,255,124,0.1);
  --indent-size: 1.5em;
}

html, body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(#001200, #000800);
  background-attachment: fixed;
  color: var(--text);
  font-family: "VT323", "Courier New", monospace;
}


body {
  display: flex;
  justify-content: center;
  padding: 2rem 0;
}

.window {
  width: 80%;
  max-width: 700px;
  padding: 2rem;
  border: 4px solid rgba(10,40,10,0.7);
  background: linear-gradient(180deg, rgba(0,20,0,0.9), rgba(0,10,0,0.85));
  border-radius: 8px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 40px black, 0 0 60px rgba(0,255,0,0.05) inset;
  margin: auto;
}

.window::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(transparent 85%, rgba(0,0,0,0.15) 86%);
  background-size: 100% 6px;
  animation: scan 3s linear infinite;
  mix-blend-mode: overlay;
  pointer-events: none;
  opacity: 0.8;
}

.window::after {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(90deg, rgba(255,255,255,0.02) 0 1px, transparent 1px 12px);
  animation: stripes 6s linear infinite;
  opacity: 0.05;
  pointer-events: none;
}

@keyframes scan { from { background-position-y: 0; } to { background-position-y: 6px; } }
@keyframes stripes { from { transform: translateX(0); } to { transform: translateX(-40px); } }

h1 {
  text-align: center;
  font-size: 28px;
  margin-top: 0;
  text-shadow: 0 0 8px var(--glow);
}

.update {
  margin-bottom: 1.25rem;
  border-left: 2px solid var(--muted);
  padding-left: 0.5rem;
}

.update h2 {
  font-size: 20px;
  margin: 0;
}

.update small {
  color: var(--muted);
  display: block;
  margin-bottom: 0.25rem;
}

.update .desc {
  margin-top: 0.5rem;
  font-size: 16px;
  line-height: 1.5;
}

.update .desc .line {
  display: block;
  text-indent: var(--indent-size);
  white-space: pre-wrap;
  margin-bottom: 0.2rem;
}

.error {
  color: red;
  text-align: center;
  font-size: 16px;
}

a {
  color: var(--text);
  text-decoration: underline;
}

a:hover {
  color: var(--text);
  text-decoration: underline;
}
</style>
</head>
<body>
<div class="window">
  <h1>Update Log</h1>
  <div id="updates"></div>
</div>

<script>
const BIN_ID = "68e7f6f843b1c97be9608347";
const JSON_BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;

function formatDescription(rawHtml = '') {
  const BR_TOKEN = '___BR_TOKEN___';
  let s = String(rawHtml);
  s = s.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
  s = s.replace(/\n/g, BR_TOKEN);
  s = s.replace(/<br\s*\/?>/gi, BR_TOKEN);

  return s.split(BR_TOKEN).map(line => {
    const trimmed = line.trim();
    return `<div class="line">${trimmed}</div>`;
  }).join('');
}

function escapeHtml(str) {
  return String(str)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}

async function fetchUpdates() {
  const container = document.getElementById('updates');
  try {
    const res = await fetch(JSON_BIN_URL);
    if (!res.ok) throw new Error('Failed to fetch update log');
    const data = await res.json();

    const updates = data.record?.updates || data.updates || [];
    if (!updates.length) {
      container.innerHTML = '<p class="error">No updates found.</p>';
      return;
    }

    container.innerHTML = updates.map(update => `
      <div class="update">
        <small>${escapeHtml(update.date || '')}</small>
        <h2>${escapeHtml(update.title || '')}</h2>
        <div class="desc">${formatDescription(update.description || '')}</div>
      </div>
    `).join('');
  } catch (err) {
    container.innerHTML = '<p class="error">âš  Unable to load updates.</p>';
    console.error(err);
  }
}

fetchUpdates();
</script>
</body>
</html>
